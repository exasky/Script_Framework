#!/bin/sh

#   To use this framework 
#           You have to implement some functions:
#
#   usage:          To explain how to use this script
#   declare_env:    To declare all variables in this script
#   check_env:      To check script's prerequisites to a good execution
#                           All script's parameters are passed through
#   main:           To launch the script execution
#                           All script's parameters are passed through
#
#
#           You have to follow some rules:
#
#   Use "source 'path_to_this_script'" at the BEGINNING of yours
#   Declare variables in declare_env function only
#   Do not call declare_env and check_env
#   Do not use commands out of a function
#       (Ignoring this may cause issues at the execution)
#       (The main function is automatically called)
#   
#
#   Author:     SIMAR Jeremy
#   Version:    0.1


# __ifndef__ 
# Does not work on Mac
script_path=$(readlink -e $0 | sed -e "s@/@_@g" -e "s@\.@_@g")
define_var="ALREADY_SOURCED_$script_path"
[[ ! -z ${!define_var} ]] && return
export ALREADY_SOURCED_$script_path="defined"
# __ifndef__ 

source "/home/simar/scripts/logFunctions.sh"

#TODO essayer de parser le script en cours avant ?
# WARN si plusieurs inclusions comment faire? 

source $(readlink -e $0)

internal_check_env() {
    ! type check_env   &> /dev/null && logFatal "Function check_env not implemented"
    ! type declare_env &> /dev/null && logFatal "Function declare_env not implemented"
    ! type usage       &> /dev/null && logFatal "Function usage not implemented"
    ! type main        &> /dev/null && logFatal "Function main not implemented"
}

internal_main() {
    internal_check_env
    declare_env
    check_env $*
    main $*
}

internal_main $*
